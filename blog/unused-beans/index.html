<!DOCTYPE html>
<html>





<head>
  <title>Quarkus - Unused Beans and Why We Remove Them</title>
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/blog/unused-beans/" />
  <meta property="og:title" content="Unused Beans and Why We Remove Them" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/blog/unused-beans/">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/goan.js" type="text/javascript"></script>
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
</head>

<body class="post">
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJWS5L"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
  <div class="container">
    <div class="logo-wrapper">
      
        <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
      
    </div>
    <label class="nav-toggle" for="checkbox">
      <i class="fa fa-bars"></i>
    </label>
    <div id="menu" class="menu">
      <span>
        <a href="/get-started/" class="">Get Started</a>
      </span>
      <span>
        <a href="/guides/" class="">Guides</a>
      </span>
      <span>
        <a href="/community/" class="">Community</a>
      </span>
      <span>
        <a href="/support/" class="">Support</a>
      </span>
      <span>
        <a href="/blog/" class="active">Blog</a>
      </span>
      <span>
        <a href="https://code.quarkus.io" class="button-cta secondary white">Start Coding</a>
      </span>
    </div>
  </div>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    <div class="post-page grid-wrapper">
  <div class="width-8-12 width-12-12-m doc-content">
    <div class="grid-wrapper">
      <div class="width-12-12">
        <p>
          <a href="/blog"><i class="fas fa-angle-left"></i> Back to all posts</a>
        </p>
      </div>
      <div class="width-12-12">
        <div class="post-date">
          September 23, 2021 
          
            <span class="tags"><a href="/blog/tag/cdi">#cdi</a><a href="/blog/tag/arc">#arc</a></span>
          
        </div>
        <h1 class="post-title">Unused Beans and Why We Remove Them</h1>
        <div class="grid-wrapper">
          <div class="width-8-12 width-12-12-m byline-wrapper">
            
            
              <img class="headshot" src="https://www.gravatar.com/avatar/8036ef0e54eaf768510dcc9be07762a6">
            
            <p class="byline">By Martin Kouba</p>
          </div>
          <div class="width-12-12">
              <div class="paragraph">
<p>Quarkus is a build-time oriented stack, i.e. it tries to do as much as possible at build time to improve the startup time and memory usage of your application.
However, it&#8217;s not always so easy and straightforward as many existing frameworks and libraries do not take this design choice into account.
And CDI is one of them.</p>
</div>
<div class="sect1">
<h2 id="why-bother"><a class="anchor" href="#why-bother"></a>Why Bother</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A traditional CDI container attempts to find all beans during the application bootstrap.
For each bean a metadata object is created and kept for the lifetime of the application.
This allows for certain degree of dynamicity at runtime but it&#8217;s suboptimal when it comes to memory consumption and application startup time.
Quarkus, on the other hand, attempts to detect and remove all <em>unused</em> beans, interceptors and decorators during build by default.
And the reason is simple.
This optimization helps to minimize the amount of generated classes and the number of metadata objects used at runtime, thus conserving memory.</p>
</div>
<div class="paragraph">
<p>Speaking of generated classes.
The bean discovery, validation and wiring all components together - all this is perfomed at build time.
Quarkus then stores the collected metadata in the bytecode, i.e. for each bean one or more classes are generated.
In order to fullfill some basic CDI API requirements, a bean has at least a corresponding <code>javax.enterprise.inject.spi.Bean</code> implementation.
If it&#8217;s a normal scoped bean then a client proxy class must be also generated.
Finally, intercepted and decorated beans require some more internal constructs.</p>
</div>
<div class="paragraph">
<p>Imagine that your application contains 50 beans that are actually not used anywhere.
If they have a normal scope (e.g. <code>@ApplicationScoped</code>) and are intercepted (e.g. declare a method annotated with <code>@Transactional</code>) you can expect more than 150 generated classes.
And these classes are completely useless.
Still, the container would have to instantiate and hold a reference on those 50+ bean metadata classes.
Needless to say, that the bean classes and any referenced classes cannot be a subject to dead code elimination when a native image is generated.
Therefore, Quarkus implements an algorithm to get rid of all these classes.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="whats-actually-removed"><a class="anchor" href="#whats-actually-removed"></a>Whatâ€™s Actually Removed?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Quarkus first identifies so-called <em>unremovable</em> beans that form the roots in the dependency tree.
Unremovable beans:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>declare an observer method, or</p>
</li>
<li>
<p>have a name designated via <code>@Named</code>, or</p>
</li>
<li>
<p>are annotated with <code>@io.quarkus.arc.Unremovable</code>, or</p>
</li>
<li>
<p>are excluded via the <code>quarkus.arc.unremovable-types</code> config property, or</p>
</li>
<li>
<p>are otherwise identified by Quarkus extensions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The last point is probably most important, because this is how application entry points are made unremovable.
A good example is a JAX-RS resource class, identified by the RESTEasy extension.
Another example is a bean which declares a <code>@Scheduled</code> method, identified by the Scheduler extension.</p>
</div>
<div class="paragraph">
<p>An <em>unused</em> bean:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>is not unremovable, and</p>
</li>
<li>
<p>is not eligible for injection to any injection point in the dependency tree, and</p>
</li>
<li>
<p>does not declare any producer which is eligible for injection to any injection point in the dependency tree, and</p>
</li>
<li>
<p>is not eligible for injection into any <code>javax.enterprise.inject.Instance</code> or <code>javax.inject.Provider</code> injection point.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Finally, unused interceptors and decorators are not associated with any bean.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
When using the dev mode (e.g. running <code>./mvnw quarkus:dev</code>), you can see more information about which beans are being removed in the Dev UI.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="main-drawback"><a class="anchor" href="#main-drawback"></a>Main Drawback</h2>
<div class="sectionbody">
<div class="paragraph">
<p>But there&#8217;s one problem.
Quarkus can&#8217;t detect the programmatic lookup performed via the <code>CDI.current()</code> static method.
Therefore, it is possible that a certain bean removal results in a false positive error, i.e. a bean is removed although it&#8217;s actually used.
In such cases, you&#8217;ll notice a big warning in the log.
Of course, users and extension authors have several options how to eliminate these errors.
For users, the easiest way is to add a special annotation: <code>@io.quarkus.arc.Unremovable</code> or use the <code>quarkus.arc.unremovable-types</code> config property.
Finally, it&#8217;s also possible to disable this optimization via the <code>quarkus.arc.remove-unused-beans=false</code> config property.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="conclusion"><a class="anchor" href="#conclusion"></a>Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Quarkus detects and removes unused beans to help you on your way to a subatomic application.
And if something goes wrong, there are options that make it possible to configure the behavior of this optimization.</p>
</div>
</div>
</div>
              
          </div>
          <div class="width-12-12"><div class="share-page">
  <a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https://quarkus.io/blog/unused-beans/&title=Unused Beans and Why We Remove Them" rel="nofollow" target="_blank" title="Share on LinkedIn">
    <img src="/assets/images/share-page/icons_social-linkedin.png"/>
  </a>
  <a class="share-twitter" href="https://twitter.com/intent/tweet?text=Unused Beans and Why We Remove Them&url=https://quarkus.io/blog/unused-beans/&via=quarkusio&related=quarkusio" rel="nofollow" target="_blank" title="Share on Twitter">
    <img src="/assets/images/share-page/icons_social-twitter.png"/>
  </a>
  <a class="share-facebook" href="https://facebook.com/sharer.php?u=https://quarkus.io/blog/unused-beans/" rel="nofollow" target="_blank" title="Share on Facebook">
    <img src="/assets/images/share-page/icons_social-facebook.png"/>
  </a>
  <a class="share-reddit" href="http://www.reddit.com/submit?url=https://quarkus.io/blog/unused-beans/" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;" title="Share on Reddit" >
    <img src="/assets/images/share-page/icons_social-reddit.png"/>
  </a>
  <a class="share-email" href="mailto:?subject=Unused Beans and Why We Remove Them&amp;body=Unused Beans and Why We Remove Them https://quarkus.io/blog/unused-beans/" title="Share via Email" >
    <img src="/assets/images/share-page/icons_social-email.png"/>
  </a>
</div>
</div>
        </div>
      </div>
    </div>
  </div>
</div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus is open. All dependencies of this project are available under the <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a> or compatible license.<br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a>, is hosted on <a href='https://pages.github.com/' target='_blank'>Github Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>fork the website</a> and show us what youâ€™ve got.</p>

    
      <div class="width-1-12 project-links">
        <span>Navigation</span>
        <ul class="footer-links">
          
            <li><a href="/">Home</a></li>
          
            <li><a href="/guides">Guides</a></li>
          
            <li><a href="/community/#contributing">Contribute</a></li>
          
            <li><a href="/faq">FAQ</a></li>
          
            <li><a href="/get-started">Get Started</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Contribute</span>
        <ul class="footer-links">
          
            <li><a href="https://twitter.com/quarkusio">Follow us</a></li>
          
            <li><a href="https://github.com/quarkusio">GitHub</a></li>
          
            <li><a href="/security">Security&nbsp;policy</a></li>
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>Get Help</span>
        <ul class="footer-links">
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus">Stack Overflow</a></li>
          
            <li><a href="https://quarkusio.zulipchat.com">Chat room</a></li>
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev">Development mailing list</a></li>
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkus is made of community projects</span>
        <ul class="footer-links">
          
            <li><a href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a href="https://code.quarkus.io/" target="_blank">And many more...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a> | <a href="https://www.redhat.com/en/about/privacy-policy">Privacy Policy</a>
    </span>
    <span class="redhat">
      Sponsored by
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/search-filter.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
</body>

</html>
